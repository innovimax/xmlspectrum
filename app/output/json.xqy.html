<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>json.xqy</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><pre class="spectrum"><span xq="yes" start="1" prev-is-closed="false" class="qname">xquery</span><span xq="yes" start="7" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="8" prev-is-closed="true" class="qname">version</span><span xq="yes" start="15" prev-is-closed="true" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="16" xq="yes">1.0-ml</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">;</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="4" prev-is-closed="false" class="qname">module</span><span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="true" class="qname">namespace</span><span xq="yes" start="20" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="21" prev-is-closed="true" class="qname">json</span><span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="26" prev-is-closed="true" class="op">=</span><span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="51" xq="yes">http://marklogic.com/json</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">;</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
</span><span class="comment" pos="81" xq="yes">(:~&#xD;
 : Module Name: Sample Library Module &#xD;
 : Module Version: 1.0 &#xD;
 : Date: October 6, 2011 &#xD;
 : Copyright: none&#xD;
 : Proprietary XQuery Extensions Used: None &#xD;
 : XQuery Specification: November 2005 &#xD;
 : Module Overview: This is a sample library module &#xD;
 : &lt;ul&gt;&#xD;
 : &lt;li&gt; Module introductory information&lt;/li&gt; &#xD;
 : &lt;li&gt; Global variables declared in this module&lt;/li&gt; &#xD;
 : &lt;li&gt; Modules imported by this module&lt;/li&gt; &#xD;
 : &lt;li&gt; Summary information for each function defined in the module&lt;/li&gt; &#xD;
 : &lt;li&gt; Detailed information for each function defined in the module&lt;/li&gt; &#xD;
 : &lt;/ul&gt;&#xD;
 : @author Jim Fuller&#xD;
 : @version 1.0&#xD;
 :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span xq="yes" start="5" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="13" prev-is-closed="true" class="qname">namespace</span><span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="23" prev-is-closed="true" class="qname">test</span><span xq="yes" start="27" prev-is-closed="true" class="op">=</span><span class="op">"</span><span class="literal" pos="729" xq="yes">test</span><span class="op">"</span><span xq="yes" start="1" prev-is-closed="true" class="op">;</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span xq="yes" start="6" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="14" prev-is-closed="true" class="qname">default</span><span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="22" prev-is-closed="true" class="qname">function</span><span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="31" prev-is-closed="true" class="qname">namespace</span><span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="775" xq="yes">http://www.w3.org/2005/xpath-functions</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">;</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span xq="yes" start="6" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="14" prev-is-closed="true" class="qname">variable</span><span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="23" prev-is-closed="true" class="variable">$new-line-regex</span><span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="39" prev-is-closed="true" class="op">as</span><span xq="yes" start="41" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="42" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="51" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="52" prev-is-closed="true" class="op">:=</span><span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="55" prev-is-closed="false" class="function">concat</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" pos="876" xq="yes">[</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="function">codepoints-to-string</span><span class="parenthesis">(</span><span xq="yes" start="23" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="24" prev-is-closed="false" class="numeric">13</span><span xq="yes" start="26" prev-is-closed="true" class="op">,</span><span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="28" prev-is-closed="false" class="numeric">10</span><span xq="yes" start="30" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="31" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="32" prev-is-closed="true" class="op">,</span><span class="op">'</span><span class="literal" pos="911" xq="yes">]+</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">;</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="921" xq="yes">(: Need to backslash escape any double quotes, backslashes, newlines and tabs :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
&#xD;
</span><span class="comment" pos="1007" xq="yes">(:~&#xD;
 : Escapes json string managing newlines as well&#xD;
 :&#xD;
 : @param $s the json to be escaped&#xD;
 : @return escaped json string&#xD;
 :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="3" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="true" class="qname">function</span><span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="20" prev-is-closed="true" class="function">json:escape</span><span class="parenthesis">(</span><span xq="yes" start="32" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="35" prev-is-closed="true" class="op">as</span><span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="38" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="47" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="49" prev-is-closed="true" class="op">as</span><span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="52" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="61" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="62" prev-is-closed="true" class="op">{</span><span xq="yes" start="63" prev-is-closed="false" class="whitespace">&#xD;
  </span><span xq="yes" start="67" prev-is-closed="false" class="higher">let</span><span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="71" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="73" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="74" prev-is-closed="true" class="op">:=</span><span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="77" prev-is-closed="false" class="function">replace</span><span class="parenthesis">(</span><span xq="yes" start="85" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="87" prev-is-closed="true" class="op">,</span><span xq="yes" start="88" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1226" xq="yes">(\\|"")</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1237" xq="yes">\\$1</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="6" prev-is-closed="true" class="higher">let</span><span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="10" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="13" prev-is-closed="true" class="op">:=</span><span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="16" prev-is-closed="false" class="function">replace</span><span class="parenthesis">(</span><span xq="yes" start="24" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="26" prev-is-closed="true" class="op">,</span><span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="28" prev-is-closed="false" class="variable">$new-line-regex</span><span xq="yes" start="43" prev-is-closed="true" class="op">,</span><span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1287" xq="yes">\\n</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="6" prev-is-closed="true" class="higher">let</span><span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="10" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="13" prev-is-closed="true" class="op">:=</span><span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="16" prev-is-closed="false" class="function">replace</span><span class="parenthesis">(</span><span xq="yes" start="24" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="26" prev-is-closed="true" class="op">,</span><span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="28" prev-is-closed="false" class="function">codepoints-to-string</span><span class="parenthesis">(</span><span xq="yes" start="49" prev-is-closed="false" class="numeric">9</span><span xq="yes" start="50" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="51" prev-is-closed="true" class="op">,</span><span xq="yes" start="52" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1344" xq="yes">\\t</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="6" prev-is-closed="true" class="op">return</span><span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="13" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="15" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="17" prev-is-closed="true" class="op">}</span><span xq="yes" start="18" prev-is-closed="true" class="op">;</span><span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="1371" xq="yes">(: Print the thing that comes after the colon :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="3" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="true" class="qname">function</span><span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="20" prev-is-closed="true" class="function">json:print-value</span><span class="parenthesis">(</span><span xq="yes" start="37" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="39" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="40" prev-is-closed="true" class="op">as</span><span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="43" prev-is-closed="false" class="node-type">element</span><span class="parenthesis">(</span><span xq="yes" start="51" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="52" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="53" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="54" prev-is-closed="true" class="op">as</span><span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="57" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="67" prev-is-closed="true" class="op">{</span><span xq="yes" start="68" prev-is-closed="false" class="whitespace">&#xD;
  </span><span xq="yes" start="72" prev-is-closed="false" class="if">if</span><span xq="yes" start="74" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="75" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="76" prev-is-closed="false" class="function">count</span><span class="parenthesis">(</span><span xq="yes" start="82" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="84" prev-is-closed="true" class="step">/</span><span xq="yes" start="85" prev-is-closed="false" class="qname">*</span><span xq="yes" start="86" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="88" prev-is-closed="true" class="op">=</span><span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="90" prev-is-closed="false" class="numeric">0</span><span xq="yes" start="91" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="93" prev-is-closed="true" class="op">then</span><span xq="yes" start="97" prev-is-closed="false" class="whitespace">&#xD;
    </span><span xq="yes" start="103" prev-is-closed="false" class="function">json:atomize</span><span class="parenthesis">(</span><span xq="yes" start="116" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="118" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="119" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="123" prev-is-closed="true" class="op">else</span><span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="128" prev-is-closed="false" class="if">if</span><span xq="yes" start="130" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="131" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="132" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="134" prev-is-closed="true" class="step">/</span><span xq="yes" start="135" prev-is-closed="false" class="axis">@</span><span xq="yes" start="136" prev-is-closed="false" class="qname">quote</span><span xq="yes" start="141" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="142" prev-is-closed="true" class="op">=</span><span xq="yes" start="143" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1562" xq="yes">true</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="3" prev-is-closed="true" class="op">then</span><span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
    </span><span xq="yes" start="13" prev-is-closed="false" class="function">concat</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" pos="1587" xq="yes">"</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="3" prev-is-closed="false" class="function">json:escape</span><span class="parenthesis">(</span><span xq="yes" start="15" prev-is-closed="false" class="function">xdmp:quote</span><span class="parenthesis">(</span><span xq="yes" start="26" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="28" prev-is-closed="true" class="step">/</span><span xq="yes" start="29" prev-is-closed="false" class="node">node(</span><span xq="yes" start="34" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="35" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="36" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="37" prev-is-closed="true" class="op">,</span><span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span><span class="op">'</span><span class="literal" pos="1628" xq="yes">"</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="6" prev-is-closed="true" class="op">else</span><span xq="yes" start="10" prev-is-closed="false" class="whitespace">&#xD;
    </span><span xq="yes" start="16" prev-is-closed="false" class="function">string-join</span><span class="parenthesis">(</span><span xq="yes" start="28" prev-is-closed="false" class="parenthesis">(</span><span class="op">'</span><span class="literal" pos="1659" xq="yes">{</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
      </span><span xq="yes" start="10" prev-is-closed="false" class="function">string-join</span><span class="parenthesis">(</span><span xq="yes" start="22" prev-is-closed="false" class="higher">for</span><span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="26" prev-is-closed="false" class="variable">$i</span><span xq="yes" start="28" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="29" prev-is-closed="true" class="op">in</span><span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="32" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="34" prev-is-closed="true" class="step">/</span><span xq="yes" start="35" prev-is-closed="false" class="qname">*</span><span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="37" prev-is-closed="true" class="op">return</span><span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="44" prev-is-closed="false" class="function">json:print-name-value</span><span class="parenthesis">(</span><span xq="yes" start="66" prev-is-closed="false" class="variable">$i</span><span xq="yes" start="68" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="69" prev-is-closed="true" class="op">,</span><span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1732" xq="yes">,</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
    </span><span class="op">'</span><span class="literal" pos="1743" xq="yes">}</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1749" xq="yes"></span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="4" prev-is-closed="true" class="op">}</span><span xq="yes" start="5" prev-is-closed="true" class="op">;</span><span xq="yes" start="6" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="1760" xq="yes">(: Print the name and value both :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="3" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="true" class="qname">function</span><span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="20" prev-is-closed="true" class="function">json:print-name-value</span><span class="parenthesis">(</span><span xq="yes" start="42" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="45" prev-is-closed="true" class="op">as</span><span xq="yes" start="47" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="48" prev-is-closed="false" class="node-type">element</span><span class="parenthesis">(</span><span xq="yes" start="56" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="57" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="59" prev-is-closed="true" class="op">as</span><span xq="yes" start="61" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="62" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="71" prev-is-closed="true" class="quantifier">?</span><span xq="yes" start="72" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="73" prev-is-closed="true" class="op">{</span><span xq="yes" start="74" prev-is-closed="false" class="whitespace">&#xD;
  </span><span xq="yes" start="78" prev-is-closed="false" class="higher">let</span><span xq="yes" start="81" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="82" prev-is-closed="false" class="variable">$name</span><span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="88" prev-is-closed="true" class="op">:=</span><span xq="yes" start="90" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="91" prev-is-closed="false" class="function">name</span><span class="parenthesis">(</span><span xq="yes" start="96" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="98" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="99" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="103" prev-is-closed="true" class="higher">let</span><span xq="yes" start="106" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="107" prev-is-closed="false" class="variable">$later-in-array</span><span xq="yes" start="122" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="123" prev-is-closed="true" class="op">:=</span><span xq="yes" start="125" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="126" prev-is-closed="false" class="higher">some</span><span xq="yes" start="130" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="131" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="133" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="134" prev-is-closed="true" class="op">in</span><span xq="yes" start="136" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="137" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="139" prev-is-closed="true" class="step">/</span><span xq="yes" start="140" prev-is-closed="false" class="axis">following-sibling::</span><span xq="yes" start="159" prev-is-closed="false" class="qname">*</span><span xq="yes" start="160" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="161" prev-is-closed="true" class="op">satisfies</span><span xq="yes" start="170" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="171" prev-is-closed="false" class="function">name</span><span class="parenthesis">(</span><span xq="yes" start="176" prev-is-closed="false" class="variable">$s</span><span xq="yes" start="178" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="179" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="180" prev-is-closed="true" class="op">=</span><span xq="yes" start="181" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="182" prev-is-closed="false" class="variable">$name</span><span xq="yes" start="187" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="191" prev-is-closed="true" class="op">return</span><span xq="yes" start="197" prev-is-closed="false" class="whitespace">&#xD;
  </span><span xq="yes" start="201" prev-is-closed="false" class="if">if</span><span xq="yes" start="203" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="204" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="205" prev-is-closed="false" class="variable">$later-in-array</span><span xq="yes" start="220" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="221" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="222" prev-is-closed="true" class="op">then</span><span xq="yes" start="226" prev-is-closed="false" class="whitespace">&#xD;
    </span><span xq="yes" start="232" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="233" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="234" prev-is-closed="true" class="whitespace">&#xD;
  </span><span xq="yes" start="238" prev-is-closed="true" class="op">else</span><span xq="yes" start="242" prev-is-closed="false" class="whitespace"> &#xD;
    </span><span xq="yes" start="249" prev-is-closed="false" class="parenthesis">(</span><span xq="yes" start="250" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="251" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="253" prev-is-closed="true" class="op">}</span><span xq="yes" start="254" prev-is-closed="true" class="op">;</span><span xq="yes" start="255" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="2053" xq="yes">(:~&#xD;
 : Transforms an XML element into a JSON string representation.  See http://json.org.&#xD;
 : &#xD;
 : Sample usage:&#xD;
 : &lt;pre&gt;&#xD;
 :   xquery version "1.0-ml";&#xD;
 :   import module namespace json="http://marklogic.com/json" at "json.xqy";&#xD;
 :   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)&#xD;
 : &lt;/pre&gt;&#xD;
 : Sample transformations:&#xD;
 : &#xD;
 : Namespace URIs are ignored.  Namespace prefixes are included in the JSON name.&#xD;
 :&#xD;
 : Attributes are ignored, except for the special attribute @array="true" that&#xD;
 : indicates the JSON serialization should write the node, even if single, as an&#xD;
 : array, and the attribute @type that can be set to "boolean" or "number" to&#xD;
 : dictate the value should be written as that type (unquoted).  There's also&#xD;
 : an @quote attribute that when set to true writes the inner content as text&#xD;
 : rather than as structured JSON, useful for sending some XHTML over the&#xD;
 : wire.&#xD;
 :&#xD;
 : Text nodes within mixed content are ignored.&#xD;
 :&#xD;
 : @param $x Element node to convert&#xD;
 : @return String holding JSON serialized representation of $x&#xD;
 :&#xD;
 : @author Jason Hunter&#xD;
 : @version 1.0.1&#xD;
 : &#xD;
 : Ported to xquery 1.0-ml; double escaped backslashes in json:escape&#xD;
:)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="3" prev-is-closed="false" class="qname">declare</span><span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="true" class="qname">function</span><span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="20" prev-is-closed="true" class="function">json:serialize</span><span class="parenthesis">(</span><span xq="yes" start="35" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="37" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="38" prev-is-closed="true" class="op">as</span><span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="41" prev-is-closed="false" class="node-type">element</span><span class="parenthesis">(</span><span xq="yes" start="49" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="50" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="51" prev-is-closed="true" class="whitespace">  </span><span xq="yes" start="53" prev-is-closed="true" class="op">as</span><span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="56" prev-is-closed="false" class="type-name">xs:string</span><span xq="yes" start="65" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="66" prev-is-closed="true" class="op">{</span><span xq="yes" start="67" prev-is-closed="false" class="whitespace">&#xD;
  </span><span xq="yes" start="71" prev-is-closed="false" class="function">string-join</span><span class="parenthesis">(</span><span xq="yes" start="83" prev-is-closed="false" class="parenthesis">(</span><span class="op">'</span><span class="literal" pos="3342" xq="yes">{</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="3" prev-is-closed="false" class="function">json:print-name-value</span><span class="parenthesis">(</span><span xq="yes" start="25" prev-is-closed="false" class="variable">$x</span><span xq="yes" start="27" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="28" prev-is-closed="true" class="op">,</span><span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span><span class="op">'</span><span class="literal" pos="3374" xq="yes">}</span><span class="op">'</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="3380" xq="yes"></span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="4" prev-is-closed="true" class="op">}</span><span xq="yes" start="5" prev-is-closed="true" class="op">;</span><span xq="yes" start="6" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span></pre></div></body></html>