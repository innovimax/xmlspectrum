<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>highlight-file.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></link></head><body><div><pre class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
     A frontend for XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)
     
     http://qutoric.com
     License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html
     
     Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats
     
     Description:
     
     A sample XSLT stylesheet that exploits xmlspectrum.xsl
     
     Takes the input file specified in the sourcepath XSLT parameter and generates an
     HTML output file ( plus also include/import files if link-names=yes ) and a CSS file.
     
     The input file may be 1 of 4 types:
     
     1. XSLT 1.0 or 2.0
     2. XSD 1.0 or 1.1
     3. Generic XML
     4. Plain-text XPath
     
     Note that this file interface is a simple wrapper for xmlspectrum.xsl. This front-end
     will auto-detect whether the file is XSLT, XSD or XPath based on well-formedness and
     namespaces. If you're converting XML samples that are not well-formed or contained within
     other XML you can code your own interface XSLT.
     
     Dependencies:
     
     1. xmlspectrum.xsl
     
     Usage:
     
     initial-template: 'main'
     source-xml: (not used)
     xsl parameters:
         sourcepath:  path or URI for source file
         color-theme: name of color-theme - default is 'solarized dark'
         link-names:  (yes|no) [Default:'no']
                      processes all linked xsl files and adds hrefs
                      for variables, functions, parameters and named templates
         css-path:    (path for output CSS)
         output-path: path in which to create html files - default is 'output/'
         output-method: [html|xml] default:html - for xml, no css file is created
     
     Sample transform using Saxon-HE/Java on command-line (unbroken line):
     
     java -cp "C:\Program Files (x86)\Saxon\saxon9he.jar" net.sf.saxon.Transform -t -it:main
     -xsl:xsl/highlight-file.xsl sourcepath=../samples/xpathcolorer-x.xsl
     
</span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w9"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xqf</span><span class="atneq">=</span><span class="z">"</span><span class="av">urn:xq.internal-function</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css xqf</span><span class="z">"</span><span class="z">
                </span><span class="atn">xpath-default-namespace</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  </span><span class="ww" id="w73"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html" class="solar"><span class="href">xmlspectrum.xsl</span></a><span class="z">"</span><span id="wx81" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w83"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="xq-spectrum.xsl.html" class="solar"><span class="href">xq-spectrum.xsl</span></a><span class="z">"</span><span id="wx91" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w93"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="make-toc.xsl.html" class="solar"><span class="href">make-toc.xsl</span></a><span class="z">"</span><span id="wx101" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w103"><span class="es">&lt;</span><span class="enxsl">xsl:output</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">html</span><span class="z">"</span><span id="wx117" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w119"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?sourcepath">sourcepath</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx141" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm">  by default - rely on original indentation </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w147"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">-1</span><span class="op">'</span><span class="z">"</span><span id="wx169" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w171"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?color-theme">color-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">dark</span><span class="op">'</span><span class="z">"</span><span id="wx187" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w189"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-path">css-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx205" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w207"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx223" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w225"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?link-names">link-names</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx241" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w243"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?output-path">output-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output/</span><span class="op">'</span><span class="z">"</span><span id="wx259" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w261"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?format-mixed-content">format-mixed-content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx277" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> set value to 'scp' for source-code-pro font </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w283"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?font-name">font-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="z">"</span><span id="wx299" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> set value to 'xml' or 'xhtml' for use in XProc step </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w305"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?output-method">output-method</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span id="wx321" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> set value to 'yes' to embed css inline with element </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w327"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-inline">css-inline</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx343" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> identifies xslt/schematron/xproc etc - not required if root namespace can be used </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w349"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?document-type">document-type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx365" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w367"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?document-type-prefix">document-type-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx383" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> 
       w3c-xpath-functions-uri is use to add hyperlinks to built-in
       xpath functions when 'link-names' = 'yes'
       set uri to a proxy server storing the W3C resource to avoid
       excessive calls to the W3C server
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w389"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?w3c-xpath-functions-uri">w3c-xpath-functions-uri</span><span class="z">"</span><span class="z">
             </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">http://www.w3.org/TR/xpath-functions/</span><span class="op">'</span><span class="z">"</span><span id="wx405" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w407"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-trim">do-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx428" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w430"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-link">do-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?link-names" class="solar"><span class="variable">$link-names</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx451" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w453"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx470" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w472"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-name">css-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">theme.css</span><span class="op">'</span><span class="z">"</span><span id="wx488" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w490"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-output-path">do-output-path</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#f?{internal}path-to-uri" class="solar"><span class="function">f:path-to-uri</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                        </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">\</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace">
                        </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="z">"</span><span id="wx561" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> use only if file is know to be well-formed, otherwise use 'main' template </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w567"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="step">/</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
    </span><span class="ww" id="w578"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-qname">root-qname</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="op">*</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName</span><span class="z">"</span><span id="wx601" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w603"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx631" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w633"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-namespace">root-namespace</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-from-QName" class="solar"><span class="function">namespace-uri-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx650" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w652"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="doctype-functions.xsl.html#f?{internal}doctype-from-xmlns" class="solar"><span class="function">f:doctype-from-xmlns</span></a><span class="parenthesis">(</span><span class="op">*</span><span class="step">/</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function">namespace-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx698" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w700"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-spans">all-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w716"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w726"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx742" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w744"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx766" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w768"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx788" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w790"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx810" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w812"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> 
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace">
                                </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx845" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx849" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx853" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w855"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w859"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">processing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tokens for</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">css-inline:</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="z">"</span><span id="wx895" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx899" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w901"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">------------------------------------------------</span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx907" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w909"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">auto-trim: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> indent: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="z">"</span><span id="wx931" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w933"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-path: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> doctype: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> root-prefix: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx964" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w966"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w983"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="z"> </span><span class="atn">disable-output-escaping</span><span class="atneq">=</span><span class="z">'</span><span class="av">yes</span><span class="z">'</span><span class="scx">&gt;</span><span class="txt">&amp;lt;!DOCTYPE html&gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx995" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx999" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1001"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1005"><span class="es">&lt;</span><span class="en">head</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1009"><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1013"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">XMLSpectrum output</span><span class="op">'</span><span class="z">"</span><span id="wx1023" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">title</span><span id="wx1027" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1029"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1046"><span class="es">&lt;</span><span class="en">style</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">text/css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1056"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-css" class="solar"><span class="function">f:get-css</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1066" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx1070" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1074" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1076"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?font-name" class="solar"><span class="variable">$font-name</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1104"><span class="es">&lt;</span><span class="en">style</span><span class="scx">&gt;</span><span class="txt">
          @import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx1110" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1114" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">head</span><span id="wx1118" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1120"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1124"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1128"><span class="es">&lt;</span><span class="en">pre</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">spectrum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1138"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1155"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}inline-css-main" class="solar"><span class="function">f:inline-css-main</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1171" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1175" class="ec">&gt;</span></span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> Call to imported functions returns sequence of span elements
                 with class attribute values used to colorise with CSS
            </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w1181"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-spans</span><span class="z">"</span><span id="wx1189" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">pre</span><span id="wx1193" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx1197" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx1201" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx1205" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1209" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1211"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?main">main</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1221"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?sourceuri">sourceuri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#p?sourcepath" class="solar"><span class="variable">$sourcepath</span></a><span class="z">"</span><span id="wx1235" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> if windows OS, convert path to URI </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w1241"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?corrected-uri1">corrected-uri1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$sourceuri</span><span class="op">,</span><span class="op">'</span><span class="literal">\\</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1268" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1270"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri-tokens">uri-tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx1299" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1301"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$uri-tokens</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="z">"</span><span id="wx1320" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1322"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?encoded-filename">encoded-filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-encode-for-uri" class="solar"><span class="function">encode-for-uri</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1339" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1341"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?directory">directory</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1374" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1376"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?corrected-uri">corrected-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$directory</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$encoded-filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1396" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w1398"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-doc-available" class="solar"><span class="function">doc-available</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xquery</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">xpath</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1442" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1444"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-element">root-element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="step">/</span><span class="op">*</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1476" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1478"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-qname">root-qname</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="variable">$root-element</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName?</span><span class="z">"</span><span id="wx1514" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1516"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> 
                          </span><span class="op">then</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace"> 
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx1580" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1582"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-namespace">root-namespace</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-from-QName" class="solar"><span class="function">namespace-uri-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1612" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1614"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="doctype-functions.xsl.html#f?{internal}doctype-from-xmlns" class="solar"><span class="function">f:doctype-from-xmlns</span></a><span class="parenthesis">(</span><span class="variable">$root-namespace</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx1671" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1673"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$doctype</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xslt</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">xsl</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1707" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1709"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">auto-trim: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> indent: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="z">"</span><span id="wx1731" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1733"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-path: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> doctype: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> root-prefix: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx1764" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1766"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1770"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xsl</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?do-link" class="solar"><span class="variable">$do-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w1784"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function">resolve-uri</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-static-base-uri" class="solar"><span class="function">static-base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1820" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1822"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-path">root-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1838"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1848"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1868" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1870"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span id="wx1884" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1886"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1901" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1905" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1909" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1911"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?joined-path">joined-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="variable">$root-path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1934" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1936"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-length">root-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$joined-path</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx1957" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1959"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1975"><span class="es">&lt;</span><span class="en">globals</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1979"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-files</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1989"><span class="es">&lt;</span><span class="en">file</span><span class="z"> </span><span class="atn">path</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-length</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w2011"><span class="es">&lt;</span><span class="en">uri</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2015"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx2023" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">uri</span><span id="wx2027" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w2029"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-globals" class="solar"><span class="function">f:get-globals</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2040" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">file</span><span id="wx2044" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2048" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">globals</span><span id="wx2052" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2056" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2058"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">------------------------------------------------</span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2064" class="ec">&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">
             &lt;xsl:message select="$globals"/&gt;
        </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w2070"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="step">/</span><span class="qname">file</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
          </span><span class="ww" id="w2082"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2086"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">tokenizing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">...</span><span class="op">'</span><span class="z">"</span><span id="wx2106" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2110" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2112"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?full-uri">full-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="qname">uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                                </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="qname">uri</span><span class="parenthesis">)</span><span class="whitespace">
                                                </span><span class="op">else</span><span class="whitespace"> </span><span class="qname">uri</span><span class="z">"</span><span id="wx2159" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2161"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-spans">all-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2177"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2187"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$full-uri</span><span class="z">"</span><span id="wx2201" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2203"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2223" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2225"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2245" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2247"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2267" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2269"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname">doc-prefix</span><span class="z">"</span><span id="wx2283" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2287" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2291" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2293"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2297"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">processing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tokens for</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">path</span><span class="z">"</span><span id="wx2323" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2327" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2329"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ancestor-length">ancestor-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2366" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2368"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ancestor-path">ancestor-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}ancestor-path" class="solar"><span class="function">f:ancestor-path</span></a><span class="parenthesis">(</span><span class="variable">$ancestor-length</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2385" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2387"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}get-xmlns" class="solar"><span class="function">f:get-xmlns</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2410" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm">
               &lt;xsl:message select="$xmlns"/&gt;
          </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm"> note: removed tunel on spans param as this caused 32% performance degrade </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ww" id="w2420"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2436"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2446"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-spans</span><span class="z">"</span><span id="wx2466" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2468"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx2494" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2496"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx2522" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2524"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2544" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2546"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$ancestor-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2572" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2576" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2580" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2582"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-css-link" class="solar"><span class="function">f:get-css-link</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2600" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2602"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2612"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx2626" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2628"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="qname">path</span><span class="z">"</span><span id="wx2643" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2645"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$css-link</span><span class="z">"</span><span id="wx2659" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2661"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx2675" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2679" class="ec">&gt;</span></span><span class="txt">
          
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2683" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2685"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#f?{internal}get-css-link" class="solar"><span class="function">f:get-css-link</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">rootlevel</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2705" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2707"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="make-toc.xsl.html#t?create-toc" class="solar"><span class="tcall">create-toc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2717"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2743" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2745"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx2759" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2761"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$css-link</span><span class="z">"</span><span id="wx2775" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2777"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">output-method</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="z">"</span><span id="wx2791" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2793"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-css-inline</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx2820" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2824" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2828" class="ec">&gt;</span></span><span class="txt">
      
      
      </span><span class="ww" id="w2830"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2834"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2850"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2860"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$corrected-uri</span><span class="z">"</span><span id="wx2874" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2876"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2896" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2898"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2918" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2920"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2940" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2942"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx2956" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2960" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2964" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2966"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2982"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2986"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-link" class="solar"><span class="variable">$do-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2996"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3006"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx3026" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w3028"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3048" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3052" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3056" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3058"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3062"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx3070" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3074" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3078" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3082" class="ec">&gt;</span></span><span class="txt">
        
        
        </span><span class="ww" id="w3084"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3101" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3103"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3113"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx3127" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3129"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$file-only</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$file-only</span><span class="whitespace">
                                                  </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xms-output</span><span class="op">'</span><span class="z">"</span><span id="wx3165" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3167"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                                  </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="whitespace">
                                  </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="z">"</span><span id="wx3200" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3202"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx3216" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3220" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3224" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3228" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3230"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xml</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3269"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">text</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3299"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-css" class="solar"><span class="function">f:get-css</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3309" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx3313" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3317" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3321" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3323"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-css-link">f:get-css-link</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3333"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path">path</span><span class="z">"</span><span id="wx3341" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3343"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#f?{internal}ancestor-path" class="solar"><span class="function">f:ancestor-path</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="z">"</span><span id="wx3395" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3399" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3401"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}ancestor-path">f:ancestor-path</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3411"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?levels">levels</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3425" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3427"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$levels</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                          </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="whitespace">
                          </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$n</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$levels</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                          </span><span class="op">'</span><span class="literal">..</span><span class="op">'</span><span class="open"></span><span class="whitespace">
                          </span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3493" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3497" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3499"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}path-to-uri">f:path-to-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3509"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path">path</span><span class="z">"</span><span id="wx3517" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3519"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3523"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function">matches</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">^[A-Za-z]:.*</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3542"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3559" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3563" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3565"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3584"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file://</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3601" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3605" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3607"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3611"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$path</span><span class="z">"</span><span id="wx3619" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3623" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3627" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3631" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3633"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?wrap-spans">wrap-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3643"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx3657" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3659"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3679" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3681"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3701" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3703"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3717" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3719"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path-length">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3739" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3741"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx3758" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3760"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">mod</span><span class="whitespace"> </span><span class="numeric">1500</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3778"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w3782"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">token: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="z">"</span><span id="wx3795" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx3799" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3803" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3805"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3809"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3820" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3822"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3842"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-children">span-children</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3858"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3868"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx3882" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3884"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx3902" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3906" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3910" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3912"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">ww</span><span class="z">"</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">w</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3931"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx3939" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3941"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span-children</span><span class="z">"</span><span id="wx3949" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx3953" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3955"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev-index">prev-index</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$span-children</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">id</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="whitespace">
                              </span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3987" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3989"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3999"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4013" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4015"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$prev-index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4033" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4037" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4041" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4043"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">sc</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ec</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4071"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">wx</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4084"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="op">|</span><span class="variable">$span</span><span class="step">/</span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4101" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4105" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4109" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4111"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w4115"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span id="wx4129" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4131"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4141"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4155" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4157"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4175" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4179" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4183" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4187" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4191" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4193"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?wrap-spans-only">wrap-spans-only</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4203"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4217" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4219"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4233" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4235"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx4252" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4254"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">mod</span><span class="whitespace"> </span><span class="numeric">1500</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4272"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4276"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">token: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="z">"</span><span id="wx4289" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx4293" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4297" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4299"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4303"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4314" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4316"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4336"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-children">span-children</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4352"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4362"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4376" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4378"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4396" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4400" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4404" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4406"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">ww</span><span class="z">"</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">w</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4425"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4433" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4435"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span-children</span><span class="z">"</span><span id="wx4443" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4447" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4449"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev-index">prev-index</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$span-children</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">id</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="whitespace">
                              </span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4481" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4483"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4493"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4507" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4509"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$prev-index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4527" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4531" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4535" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4537"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">sc</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ec</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4565"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">wx</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4578"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="op">|</span><span class="variable">$span</span><span class="step">/</span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4595" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4599" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4603" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4605"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4609"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4617" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4619"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4629"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4643" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4645"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4663" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4667" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4671" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4675" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4679" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w4681"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-common-root">get-common-root</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4697"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4717" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4719"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4733" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4735"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?common-path">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx4749" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4751"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?current-file">current-file</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$all-files</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4776" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4778"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?min-file">min-file</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><span class="variable">$current-file</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#f?{internal}min-common-item" class="solar"><span class="function">f:min-common-item</span></a><span class="parenthesis">(</span><span class="variable">$common-path</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$current-file</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4822" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4824"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4828"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-files</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4845"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4855"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4873" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4875"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min-file</span><span class="z">"</span><span id="wx4889" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4893" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4897" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4899"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4903"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min-file</span><span class="z">"</span><span id="wx4911" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4915" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4919" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4923" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4925"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}min-common-item">f:min-common-item</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4941"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?min">min</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx4955" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4957"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new">new</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx4971" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w4973"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$min</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4990"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?x">x</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5013" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5015"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$new</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5035"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="z">"</span><span id="wx5046" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5050" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5054" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5058" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5060"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-all-files">f:get-all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5076"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new-uri">new-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5090" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5092"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri-list">uri-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5106" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5108"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri-parts">uri-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$new-uri</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="op">,</span><span class="op">'</span><span class="literal">/|\\</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5139" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5141"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="whitespace">
                          </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function">subsequence</span></a><span class="parenthesis">(</span><span class="variable">$uri-parts</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$uri-parts</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="z">"</span><span id="wx5195" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5197"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$uri-list</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5214" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5218" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5220"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-all-files">f:get-all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5236"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5250" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5252"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new-uri">new-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5266" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5268"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri-list">uri-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5282" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5284"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?add-uri">add-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$file</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$new-uri</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                          </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$file</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$uri-list</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#f?{internal}fix-uri" class="solar"><span class="function">f:fix-uri</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$file</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5339" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5341"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-externals">new-externals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5357"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$add-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5367"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?has-protocol">has-protocol</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5395" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5397"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="parenthesis">(</span><span class="variable">$has-protocol</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="op">'</span><span class="literal">plugin:</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$has-protocol</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5431"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5448" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5450"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:import</span><span class="step">/</span><span class="axis">@</span><span class="qname">href</span><span class="op">|</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:include</span><span class="step">/</span><span class="axis">@</span><span class="qname">href</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5476"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function">resolve-uri</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="variable">$doc</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5493" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5497" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5501" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5505" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5509" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5511"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?concat-sequence">concat-sequence</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$uri-list</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$add-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5530" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5532"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5536"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$new-externals</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5549"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-externals</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$concat-sequence</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5566" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5570" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5572"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5576"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$concat-sequence</span><span class="z">"</span><span id="wx5584" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5588" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5592" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5596" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5598"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}fix-uri">f:fix-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5614"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5628" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5630"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri">uri</span><span class="z">"</span><span id="wx5638" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5640"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">plugin:</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function">substring-after</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$uri</span><span class="z">"</span><span id="wx5683" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5687" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm">
       sample globals elements:
       &lt;doc-prefix&gt;xsl&lt;/doc-prefix&gt;
       &lt;function name="do-something" ns="internal"/&gt;
       &lt;function name="somethin-else" ns="internal"/&gt;
       &lt;template name="output-days" ns=""/&gt;
       &lt;variable name="my-global" ns=""/&gt;
  </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w5693"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-globals">f:get-globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5709"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?file-uri">file-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5723" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5725"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="variable">$file-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5742" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5744"><span class="es">&lt;</span><span class="en">doc-prefix</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5748"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5764" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">doc-prefix</span><span id="wx5768" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5770"><span class="es">&lt;</span><span class="en">templates</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5774"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:template</span><span class="filter">[</span><span class="axis">@</span><span class="qname">name</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx5796" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">templates</span><span id="wx5800" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5802"><span class="es">&lt;</span><span class="en">functions</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5806"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:function</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx5824" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">functions</span><span id="wx5828" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5830"><span class="es">&lt;</span><span class="en">variables</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5834"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="parenthesis">(</span><span class="qname">xsl:variable</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx5854" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">variables</span><span id="wx5858" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5860"><span class="es">&lt;</span><span class="en">params</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5864"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="parenthesis">(</span><span class="qname">xsl:param</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx5884" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">params</span><span id="wx5888" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5892" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5894"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname">xsl:template</span><span class="op">|</span><span class="qname">xsl:function</span><span class="op">|</span><span class="qname">xsl:variable</span><span class="op">|</span><span class="qname">xsl:param</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5916"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?after-colon">after-colon</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function">substring-after</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">name</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5940" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5942"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local">local</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$after-colon</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">name</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$after-colon</span><span class="z">"</span><span id="wx5976" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5978"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function">substring-before</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">name</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6002" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
         &lt;item name="{$local}" ns="{namespace-uri-for-prefix($prefix, .)}"/&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w6008"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><span class="variable">$local</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-for-prefix" class="solar"><span class="function">namespace-uri-for-prefix</span></a><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="op">,</span><span class="whitespace"> </span><span class="context">.</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
                          </span><span class="op">'</span><span class="literal">}</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$local</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6065" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6067"><span class="es">&lt;</span><span class="en">item</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6071"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$clark-name</span><span class="z">"</span><span id="wx6079" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">item</span><span id="wx6083" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6087" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6089"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?output-html-doc">output-html-doc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6099"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx6113" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6115"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?filename">filename</span><span class="z">"</span><span id="wx6123" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6125"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-link">css-link</span><span class="z">"</span><span id="wx6133" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6135"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?html-path">html-path</span><span class="z">"</span><span id="wx6143" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6145"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6162" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6164"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href-1">href-1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$html-path</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6184" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6186"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xml</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                                      </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$href-1</span><span class="whitespace">
                                      </span><span class="op">else</span><span class="whitespace">
                                      </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$href-1</span><span class="op">,</span><span class="op">'</span><span class="literal">.</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx6230" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6232"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">writing: </span><span class="ww" id="w6236"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$href</span><span class="z">"</span><span id="wx6244" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx6248" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6250"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">file: </span><span class="ww" id="w6254"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$filename</span><span class="z">"</span><span id="wx6262" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx6266" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6268"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable">$href</span><span class="op">}</span><span class="z">"</span><span class="z">
                         </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
      </span><span class="ww" id="w6294"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6311"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="z"> </span><span class="atn">disable-output-escaping</span><span class="atneq">=</span><span class="z">'</span><span class="av">yes</span><span class="z">'</span><span class="scx">&gt;</span><span class="txt">&amp;lt;!DOCTYPE html&gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6323" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6327" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6329"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-method</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="z">"</span><span id="wx6342" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6344"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6348"><span class="es">&lt;</span><span class="en">head</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6352"><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6356"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$file-only</span><span class="z">"</span><span id="wx6364" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">title</span><span id="wx6368" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6370"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6387"><span class="es">&lt;</span><span class="en">link</span><span class="z"> </span><span class="atn">rel</span><span class="atneq">=</span><span class="z">"</span><span class="av">stylesheet</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">text/css</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable">$css-link</span><span class="op">}</span><span class="z">"</span><span id="wx6409" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6413" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6415"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?font-name" class="solar"><span class="variable">$font-name</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6443"><span class="es">&lt;</span><span class="en">style</span><span class="scx">&gt;</span><span class="txt">
            @import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx6449" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6453" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">head</span><span id="wx6457" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w6459"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6463"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6467"><span class="es">&lt;</span><span class="en">pre</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">spectrum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6477"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6494"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}inline-css-main" class="solar"><span class="function">f:inline-css-main</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6510" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6514" class="ec">&gt;</span></span><span class="txt">
              </span><span class="z">&lt;!--</span><span class="cm"> Call to imported functions returns sequence of span elements
                   with class attribute values used to colorise with CSS
              </span><span class="z">--&gt;</span><span class="txt">
              </span><span class="ww" id="w6520"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                    </span><a href="xslt-formatting-functions.xsl.html#f?{internal}add-nbsp" class="solar"><span class="function">f:add-nbsp</span></a><span class="parenthesis">(</span><span class="variable">$result-spans</span><span class="parenthesis">)</span><span class="whitespace">
                                    </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx6550" class="sc">/&gt;</span></span><span class="txt">
              
            </span><span class="ez">&lt;/</span><span class="cl">pre</span><span id="wx6554" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx6558" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx6562" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx6566" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx6570" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6574" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6576"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}file-from-uri">f:file-from-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6586"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri">uri</span><span class="z">"</span><span id="wx6594" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6596"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/|\\</span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="z">"</span><span id="wx6618" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6622" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6624"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-result-spans">get-result-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6634"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?input-uri">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6648" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6650"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6664" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6666"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6680" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6682"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6696" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6698"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6712" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6714"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml-new">is-xml-new</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace">
                          </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$doctype</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xpath</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xquery</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6785" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6787"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fixed-uri">fixed-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}path-to-uri" class="solar"><span class="function">f:path-to-uri</span></a><span class="parenthesis">(</span><span class="variable">$input-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6804" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6806"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6810"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">input-uri</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$fixed-uri</span><span class="z">"</span><span id="wx6823" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx6827" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6829"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-content">file-content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable">$fixed-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6852" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6854"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre-file-only">pre-file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$input-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6871" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6873"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$pre-file-only</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$pre-file-only</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xms-output</span><span class="op">'</span><span class="z">"</span><span id="wx6909" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6911"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6915"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml-new</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable">$do-trim</span></a><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w6944"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function">f:render</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6961" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6965" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6967"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml-new</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text and indentation required </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w6981"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function">f:render</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7004" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7006"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?real-indent">real-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z">
                      </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7042" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7044"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}indent" class="solar"><span class="function">f:indent</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$real-indent</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable">$do-trim</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx7061" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7065" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7067"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is standalone </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">        &lt;xsl:sequence select="loc:showXPath($file-content)"/&gt;</span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7079"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xptokens">xptokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-spectrum.xsl.html#f?{urn:xq.internal-function}show-xquery" class="solar"><span class="function">xqf:show-xquery</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7102" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7104"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="xmlspectrum.xsl.html#f?{internal}style-spans" class="solar"><span class="function">f:style-spans</span></a><span class="parenthesis">(</span><span class="variable">$xptokens</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$xptokens</span><span class="z">"</span><span id="wx7134" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7138" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7142" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7146" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx7150" class="ec">&gt;</span></span><span class="txt">
</span></pre></div></body></html>