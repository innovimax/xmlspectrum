<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>get-code.xqy</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><pre class="spectrum"><span class="comment" pos="1" xq="yes">(:&#xD;
 : Copyright (c)2006 Elsevier, Inc.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 : http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 : The use of the Apache License does not indicate that this project is&#xD;
 : affiliated with the Apache Software Foundation.&#xD;
 :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="744" xq="yes">(:~ &#xD;
 :  This main module controls the presentation of the code for either&#xD;
 :  an entire mdoule or a particlur function within a module. &#xD;
 :  The mainline function invokes only the&#xD;
 :  method to retrieve the source code.  The 'module' and 'function' parameters&#xD;
 :  are extracted from the query-string.  If only a 'module' is specified, then&#xD;
 :  the source code for the entire module will be returned.  If both a 'module'&#xD;
 :  and a 'function' are specified, only the source code for the specified function&#xD;
 :  within the module will be returned. A parameter of type xs:boolean &#xD;
 :  is passed to indicate whether links on the page should be constructed &#xD;
 :  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;
 :  real-time viewing.&#xD;
 : &#xD;
 :  @author Darin McBeath&#xD;
 :  @since June 9, 2006&#xD;
 :  @version 1.3&#xD;
 :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span xq="yes" start="5" prev-is-closed="false" class="qname">import</span><span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="12" prev-is-closed="true" class="qname">module</span><span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="19" prev-is-closed="true" class="qname">namespace</span><span xq="yes" start="28" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="29" prev-is-closed="true" class="qname">display</span><span xq="yes" start="36" prev-is-closed="true" class="op">=</span><span class="op">"</span><span class="literal" pos="1626" xq="yes">xqdoc/xqdoc-display</span><span class="op">"</span><span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="2" prev-is-closed="true" class="qname">at</span><span xq="yes" start="4" prev-is-closed="true" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1651" xq="yes">xqdoc-display.xqy</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">;</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span class="comment" pos="1675" xq="yes">(: Disable caching and set content type :)</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="3" prev-is-closed="false" class="function">xdmp:set-response-content-type</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="1750" xq="yes">text/html</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="5" prev-is-closed="false" class="function">xdmp:add-response-header</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="1790" xq="yes">Pragma</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1800" xq="yes">no-cache</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="5" prev-is-closed="false" class="function">xdmp:add-response-header</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="1839" xq="yes">Cache-Control</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1856" xq="yes">no-cache</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
</span><span xq="yes" start="5" prev-is-closed="false" class="function">xdmp:add-response-header</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="1895" xq="yes">Expires</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="op">,</span><span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span><span class="op">"</span><span class="literal" pos="1906" xq="yes">0</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="op">,</span><span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span><span xq="yes" start="7" prev-is-closed="false" class="higher">let</span><span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="11" prev-is-closed="false" class="variable">$module</span><span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="19" prev-is-closed="true" class="op">:=</span><span xq="yes" start="21" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="22" prev-is-closed="false" class="function">xdmp:get-request-field</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="1953" xq="yes">module</span><span class="op">"</span><span class="open"></span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="4" prev-is-closed="true" class="higher">let</span><span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="8" prev-is-closed="false" class="variable">$function</span><span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span><span xq="yes" start="18" prev-is-closed="true" class="op">:=</span><span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="21" prev-is-closed="false" class="function">xdmp:get-request-field</span><span class="parenthesis">(</span><span class="op">"</span><span class="literal" pos="2004" xq="yes">function</span><span class="op">"</span><span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
</span><span xq="yes" start="4" prev-is-closed="true" class="op">return</span><span xq="yes" start="10" prev-is-closed="false" class="whitespace">&#xD;
  &#xD;
  </span><span xq="yes" start="18" prev-is-closed="false" class="function">display:get-code-html</span><span class="parenthesis">(</span><span xq="yes" start="40" prev-is-closed="false" class="variable">$module</span><span xq="yes" start="47" prev-is-closed="true" class="op">,</span><span xq="yes" start="48" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="49" prev-is-closed="false" class="variable">$function</span><span xq="yes" start="58" prev-is-closed="true" class="op">,</span><span xq="yes" start="59" prev-is-closed="false" class="whitespace"> </span><span xq="yes" start="60" prev-is-closed="false" class="function">false</span><span class="parenthesis">(</span><span xq="yes" start="66" prev-is-closed="false" class="parenthesis">)</span><span xq="yes" start="67" prev-is-closed="true" class="parenthesis">)</span><span xq="yes" start="68" prev-is-closed="true" class="whitespace"> &#xD;
&#xD;
&#xD;
</span></pre></div></body></html>