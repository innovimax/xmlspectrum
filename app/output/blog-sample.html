<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml">
<link rel="stylesheet" type="text/css" href="theme.css"></link>
<title>Test XMLSpectrum</title>

<body>
<h1>XMLSpectrum: Rendering XSLT 2.0 for the Web</h1>
<p>The XSLT language, especially in version 2.0, presents a number of unique challenges when it comes to rendering the code to enhance readability:</p>
<ul>
<li>XSLT instructions are formatted as XML which has its own formatting and syntax-highlighing conventions.</li>
<li>The instructions for XSLT may contain XPath 2.0 expressions, these have their own formatting and syntax-highlighting conventions.</li>
<li>Generic syntax-highlighters struggle with the XPath syntax as it is significantly different to languages from the 'curly brace' family.</li>
<li>Literal XML elements can be interspersed in certain points within the XSLT.</li>
<li>The XSLT is itself embedded in HTML tags for rendering prose and graphics etc.</li>
</ul>
<p>The <strong>XMLSpectrum</strong> project I've launched aims to address syntax-highlighting and formatting issues by providing a core XSLT stylesheet with functions to transform XSLT, XSD and XPath code to HTML.</p>
<p>In this blog post, I'm using HTML transformed from an <a href="input-blog-sample.xml">XHTML source</a> using the <code><a href="https://github.com/pgfearo/xmlspectrum">xmlspectrum.xsl</a></code> stylesheet - a small top-level stylesheet, <code>highlight-inline.xsl</code> imports this to provide a convenient method to run from the transform from the command line (using Saxon-HE in this case).</p>
<h2>XSLT Code Sample</h2>
<p> The following XSLT code is within a <code>CDATA</code> section of a <code>pre</code> element, however it is not highlighted because no <code>lang</code> attribute is present on the element.</p>
<hr></hr>
<pre>

&lt;xsl:variable name="line-parts" as="element()*"&gt;
&lt;xsl:analyze-string select="$span" regex="\n.*"&gt;
&lt;xsl:matching-substring&gt;
&lt;nl&gt;
&lt;xsl:variable name="text" select="substring(., 2)"
as="xs:string"/&gt;
&lt;xsl:value-of select="if ($auto-trim)
then f:left-trim($text)
else $text"/&gt;
&lt;/nl&gt;
&lt;/xsl:matching-substring&gt;
&lt;xsl:non-matching-substring&gt;
&lt;tt&gt;
&lt;xsl:value-of select="."/&gt;
&lt;/tt&gt;
&lt;/xsl:non-matching-substring&gt;
&lt;/xsl:analyze-string&gt;
&lt;/xsl:variable&gt;
</pre>
<hr></hr>
<p>I find the above XSLT quite hard to follow. The absence of syntax-highlighting is not the greatest issue here, its the lack of XML indentation - there's some XPath indentation, but it doesn't appear distinct from the XML.</p>
<hr></hr>
<h2>XSLT Code Sample - With Formatting</h2>
<p>Now, lets use exactly the same content but add a <code>lang="xslt"</code> attribute to the <code>pre</code> element:</p>
<pre class="spectrum" lang="xslt" data-indent="2"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">line-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n.*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="en">nl</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">substring</span><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">2</span><span class="parenthesis">)</span><span class="z">"</span><span class="z">
                      </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$auto-trim</span><span class="parenthesis">)</span><span class="whitespace">
                              </span><span class="op">then</span><span class="whitespace"> </span><span class="function">f:left-trim</span><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="whitespace">
                              </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$text</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">nl</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">tt</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$isElementClose</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ez</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="function">concat</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">&amp;lt;</span><span class="op">'</span><span class="op">,</span><span class="variable">$tagStart</span><span class="parenthesis">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">firstLine</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$line-parts</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">indented-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$a</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$line-parts</span><span class="filter">[</span><span class="function">name</span><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">nl</span><span class="op">'</span><span class="filter">]</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                        </span><span class="function">string</span><span class="parenthesis">(</span><span class="variable">$a</span><span class="parenthesis">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">flat-part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$line-parts</span><span class="filter">[</span><span class="function">name</span><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tt</span><span class="op">'</span><span class="filter">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> should be max of 1 </span><span class="z">--&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">flat-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$flat-part</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$flat-part</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> constant indent when first attribute is on a new line </span><span class="z">--&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">compact</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">4</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">lineOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="function">exists</span><span class="parenthesis">(</span><span class="variable">$firstLine</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace"> </span><span class="function">string-length</span><span class="parenthesis">(</span><span class="variable">$firstLine</span><span class="parenthesis">)</span><span class="whitespace">
                      </span><span class="op">else</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">an-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
                      </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace">
                      </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="function">exists</span><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                          </span><span class="variable">$compact</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace">
                      </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span></pre>
<p>By the addition of the <code>lang</code> attribute, the above snippet has been transformed to be much more readable and what we would hope to see in an XSLT editor (but sadly even some XSLT editors fail to provide this level of colorisation or formatting). A dark color theme has been chosen here (a light theme is also available) to provide better hue contrast.</p>
<p>There are a number of characteristics of the rendered code that are worth highlighting. First, XSLT instructions are distinguished from XPath code by using cooler colors for the former. There is also special coloring for literal result elements and the name attribute value for xsl:variable instructions. Attribute Value Templats (AVTs) are also recognized and colorised properly. Note also the indentation of the attributes and their values so they are all aligned vertically, if they appear on new lines - but with the indentation of enclosed XPath expressions preserved.</p>
<h2>XSD Code Sample</h2>
<p>And now I would like to show some XSD 1.1 code to show that this transform is easily extended for any XML vocabularies that contain XPath. This sample is from <a href="http://mukulgandhi.blogspot.co.uk/2010/03/playing-again-with-xsd-11-assertions.html">Mukul Ghandi's blog</a>:</p>
<pre class="spectrum" lang="xsd" data-indent="1"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="UTF-8" </span><span class="z">?&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> reproduced from Mukul Gandhi blog at:
     http://mukulgandhi.blogspot.co.uk/2010/03/playing-again-with-xsd-11-assertions.html
</span><span class="z">--&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">xs:schema</span><span class="z"> </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
 
 </span><span class="es">&lt;</span><span class="en">xs:complexType</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">Product</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="en">xs:sequence</span><span class="scx">&gt;</span><span class="txt">
   </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">shortName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="en">xs:simpleType</span><span class="scx">&gt;</span><span class="txt">
     </span><span class="es">&lt;</span><span class="en">xs:restriction</span><span class="z"> </span><span class="atn">base</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="en">xs:maxLength</span><span class="z"> </span><span class="atn">value</span><span class="atneq">=</span><span class="z">"</span><span class="av">20</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
     </span><span class="ez">&lt;/</span><span class="cl">xs:restriction</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">xs:simpleType</span><span class="ec">&gt;</span><span class="txt">
   </span><span class="ez">&lt;/</span><span class="clxsl">xs:element</span><span class="ec">&gt;</span><span class="txt">
   </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">description</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
   </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">author</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
   </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">price</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="en">xs:complexType</span><span class="scx">&gt;</span><span class="txt">
     </span><span class="es">&lt;</span><span class="en">xs:sequence</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">value</span><span class="z">"</span><span class="z"> </span><span class="atn">maxOccurs</span><span class="atneq">=</span><span class="z">"</span><span class="av">unbounded</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
       </span><span class="es">&lt;</span><span class="en">xs:complexType</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="en">xs:simpleContent</span><span class="scx">&gt;</span><span class="txt">
         </span><span class="es">&lt;</span><span class="en">xs:extension</span><span class="z"> </span><span class="atn">base</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:double</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xs:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">effective</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:date</span><span class="z">"</span><span class="z"> </span><span class="atn">use</span><span class="atneq">=</span><span class="z">"</span><span class="av">required</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xs:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">freeware</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xs:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">format</span><span class="z">"</span><span class="z"> </span><span class="atn">use</span><span class="atneq">=</span><span class="z">"</span><span class="av">required</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
           </span><span class="es">&lt;</span><span class="en">xs:simpleType</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="en">xs:restriction</span><span class="z"> </span><span class="atn">base</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
             </span><span class="es">&lt;</span><span class="en">xs:enumeration</span><span class="z"> </span><span class="atn">value</span><span class="atneq">=</span><span class="z">"</span><span class="av">hard cover</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
             </span><span class="es">&lt;</span><span class="en">xs:enumeration</span><span class="z"> </span><span class="atn">value</span><span class="atneq">=</span><span class="z">"</span><span class="av">pdf</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">xs:restriction</span><span class="ec">&gt;</span><span class="txt">
           </span><span class="ez">&lt;/</span><span class="cl">xs:simpleType</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xs:attribute</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="en">xs:assert</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="qname">effective</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="function">current-date</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="en">xs:assert</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">freeware</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="function">true</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">format</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">pdf</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace">
                           </span><span class="op">else</span><span class="whitespace"> </span><span class="function">true</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">                    
         </span><span class="ez">&lt;/</span><span class="cl">xs:extension</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">xs:simpleContent</span><span class="ec">&gt;</span><span class="txt">
       </span><span class="ez">&lt;/</span><span class="cl">xs:complexType</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xs:element</span><span class="ec">&gt;</span><span class="txt">
     </span><span class="ez">&lt;/</span><span class="cl">xs:sequence</span><span class="ec">&gt;</span><span class="txt">
     </span><span class="es">&lt;</span><span class="en">xs:assert</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher">every</span><span class="whitespace"> </span><span class="variable">$vl</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="qname">value</span><span class="filter">[</span><span class="function">position</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="function">last</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="whitespace"> </span><span class="op">satisfies</span><span class="whitespace">
                      </span><span class="parenthesis">(</span><span class="variable">$vl</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="variable">$vl</span><span class="step">/</span><span class="axis">following-sibling::</span><span class="qname">value</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> 
                      </span><span class="parenthesis">(</span><span class="variable">$vl</span><span class="step">/</span><span class="axis">@</span><span class="qname">effective</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="variable">$vl</span><span class="step">/</span><span class="axis">following-sibling::</span><span class="qname">value</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">effective</span><span class="parenthesis">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">xs:complexType</span><span class="ec">&gt;</span><span class="txt">
   </span><span class="ez">&lt;/</span><span class="clxsl">xs:element</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">xs:sequence</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xs:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">ID</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:positiveInteger</span><span class="z">"</span><span class="z"> </span><span class="atn">use</span><span class="atneq">=</span><span class="z">"</span><span class="av">required</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
 </span><span class="ez">&lt;/</span><span class="cl">xs:complexType</span><span class="ec">&gt;</span><span class="txt">
 
 </span><span class="es">&lt;</span><span class="enxsl">xs:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">product</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">Product</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
 
</span><span class="ez">&lt;/</span><span class="cl">xs:schema</span><span class="ec">&gt;</span><span class="txt">


</span></pre>
<p>In the above sample the nesting-level is quite high, I've therefore used the <code>data-indent="1"</code> attribute setting on the <code>pre</code> element to reduce indentation from the <code>2</code> that was set from the command-line transform. An annoyance though is that there is still some wrapping. The <code>lang="xsd"</code> attribute setting was also used on the <code>pre</code> element</p>
<p>
<em>Note that the XML editor I used for the source of this blog uses virtual formatting for XML - no formatting characters except <code>\n</code> are inserted, a continuously adaptive margin provides a similar effect but without the latency. XML pasted in (like from Mukul's blog) is trimmed automatically, unless special space-preserve rules apply. because of this there was no need to specifically trim the source code.</em></p>
<p>
<em>A command-line <code>auto-trim=yes</code> parameter is available for the majority who use conventional 'character-injection' formatting and need to tidy the indentation - otherwise formatting will be preserved - and there's no need to use the <code>indent</code> command-line parameter like I have.</em></p>
<p>As stated earlier code that wraps in the rendered output will not indent properly. This is because (though it is more complex to code) I have gone with the convention of inserting space characters instead of using CSS styling to indent. This at least allows for easier copy and paste for those using editors limited to conventional formatting - but does not fit well with the new <code>Responsive Web Design</code> that is increasingly important because of small-screen mobile devices.</p>
<h2>XPath Code Sample</h2>
<p>Time for one last sample, the follwing is just standalone XPath within a <code>pre</code> element with the <code>lang="xpath"</code> attribute setting:
</p>
<pre class="spectrum" lang="xpath"><span class="open"></span><span class="whitespace">   </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="function">substring</span><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;#x</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
        </span><span class="function">codepoints-to-string</span><span class="parenthesis">(</span><span class="whitespace">
            </span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="whitespace">
                </span><span class="function">js:hexToDecimal</span><span class="parenthesis">(</span><span class="whitespace">
                    </span><span class="function">substring</span><span class="parenthesis">(</span><span class="variable">$precolon</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">4</span><span class="parenthesis">)</span><span class="whitespace">
                </span><span class="parenthesis">)</span><span class="whitespace">
            </span><span class="parenthesis">)</span><span class="whitespace">
        </span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="function">substring</span><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="numeric">1</span><span class="op">,</span><span class="numeric">2</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;#</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
        </span><span class="function">codepoints-to-string</span><span class="parenthesis">(</span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="function">substring</span><span class="parenthesis">(</span><span class="variable">$precolon</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;amp;</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;</span><span class="op">'</span><span class="open"></span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;lt;</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;lt;</span><span class="op">'</span><span class="open"></span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;gt;</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;gt;</span><span class="op">'</span><span class="open"></span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;quot;</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;quot;</span><span class="op">'</span><span class="open"></span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;amp;apos;</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;apos;&amp;apos;</span><span class="op">'</span><span class="open"></span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="whitespace">

</span></pre>
<h2>XQuery Code Sample</h2>
<p><em>[Reproduced from W3C XQuery 3.0 specification at: <a href="http://www.w3.org/TR/2014/REC-xquery-30-20140408/">http://www.w3.org/TR/2014/REC-xquery-30-20140408/</a>]</em></p>
<pre class="spectrum" lang="xquery"><span class="open"></span><span class="whitespace">declare function</span><span class="whitespace"> </span><span class="function">local:swizzle</span><span class="parenthesis">(</span><span class="variable">$n</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> 
  </span><span class="op">{</span><span class="whitespace"> 
   </span><span class="axis">typeswitch</span><span class="parenthesis">(</span><span class="variable">$n</span><span class="parenthesis">)</span><span class="whitespace">
     </span><span class="axis">case</span><span class="whitespace"> </span><span class="variable">$a</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">attribute</span><span class="parenthesis">(</span><span class="qname">color</span><span class="parenthesis">)</span><span class="whitespace">
       </span><span class="op">return</span><span class="whitespace"> </span><span class="axis">element</span><span class="whitespace"> </span><span class="qname">color</span><span class="whitespace"> </span><span class="op">{</span><span class="whitespace"> </span><span class="function">fn:string</span><span class="parenthesis">(</span><span class="variable">$a</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">}</span><span class="whitespace"> 
     </span><span class="axis">case</span><span class="whitespace"> </span><span class="variable">$es</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">element</span><span class="parenthesis">(</span><span class="qname">size</span><span class="parenthesis">)</span><span class="whitespace"> 
       </span><span class="op">return</span><span class="whitespace"> </span><span class="axis">attribute</span><span class="whitespace"> </span><span class="qname">size</span><span class="whitespace"> </span><span class="op">{</span><span class="whitespace"> </span><span class="function">fn:string</span><span class="parenthesis">(</span><span class="variable">$es</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">}</span><span class="whitespace"> 
     </span><span class="axis">case</span><span class="whitespace"> </span><span class="variable">$e</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">element</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> 
       </span><span class="op">return</span><span class="whitespace"> </span><span class="axis">element</span><span class="whitespace"> 
         </span><span class="op">{</span><span class="whitespace"> </span><span class="function">fn:local-name</span><span class="parenthesis">(</span><span class="variable">$e</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">}</span><span class="whitespace"> 
         </span><span class="op">{</span><span class="whitespace"> </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> 
             </span><span class="parenthesis">(</span><span class="variable">$e</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="whitespace"> </span><span class="op">except</span><span class="whitespace"> </span><span class="variable">$e</span><span class="step">/</span><span class="axis">@</span><span class="qname">color</span><span class="op">,</span><span class="whitespace">     </span><span class="comment">(: attr -&gt; attr :)</span><span class="open"></span><span class="whitespace">
              </span><span class="variable">$e</span><span class="step">/</span><span class="qname">size</span><span class="op">,</span><span class="whitespace">                    </span><span class="comment">(: elem -&gt; attr :)</span><span class="open"></span><span class="whitespace">
              </span><span class="variable">$e</span><span class="step">/</span><span class="axis">@</span><span class="qname">color</span><span class="op">,</span><span class="whitespace">                  </span><span class="comment">(: attr -&gt; elem :)</span><span class="whitespace">
              </span><span class="variable">$e</span><span class="step">/</span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">except</span><span class="whitespace"> </span><span class="variable">$e</span><span class="step">/</span><span class="qname">size</span><span class="whitespace"> </span><span class="parenthesis">)</span><span class="whitespace">  </span><span class="comment">(: elem -&gt; elem :)</span><span class="open"></span><span class="whitespace">
           </span><span class="op">return</span><span class="whitespace"> </span><span class="function">local:swizzle</span><span class="parenthesis">(</span><span class="variable">$c</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">}</span><span class="whitespace">
     </span><span class="axis">case</span><span class="whitespace"> </span><span class="variable">$d</span><span class="whitespace"> </span><span class="op">as</span><span class="whitespace"> </span><span class="node-type">document-node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> 
       </span><span class="op">return</span><span class="whitespace"> </span><span class="axis">document</span><span class="whitespace"> 
         </span><span class="op">{</span><span class="whitespace"> </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$d</span><span class="step">/</span><span class="op">*</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace"> </span><span class="function">local:swizzle</span><span class="parenthesis">(</span><span class="variable">$c</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">}</span><span class="whitespace"> 
     </span><span class="axis">default</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace"> </span><span class="variable">$n</span><span class="whitespace"> 
  </span><span class="op">}</span><span class="op">;</span><span class="whitespace">
</span></pre>
<h2>Using XMLSpectrum</h2>
<p>Code, documentation and samples to produce output similar to that in this blow are all available from the GitHub <code><a href="https://github.com/pgfearo/xmlspectrum">xmlspectrum</a></code> project site. With Blogger, I needed to copy and paste the generated CSS into the <code>b:style</code> element of the blog template that will style all my subsequent blog. The HTML output form the transform was just copied and pasted into the <code>HTML edit</code> view - but I would like to automate this process if possible.</p>
<p>The command line used to run the transform:</p>
<pre>
java -cp "C:\Program Files (x86)\Saxon\saxon9he.jar" \
net.sf.saxon.Transform -t -xsl:xsl/highlight-inline.xsl \
-s:samples/blog-sample.html indent=2 -o:output/blog-sample.html
</pre>
<h2>Reasons for not using a generic JavaScript based syntax highlighter</h2>
<ul>
<li>Most highlighters can't cope with XPath's more complex syntax rules</li>
<li>As parsing is processor intensive and a 'one-off' it is well suited to server-side processing.</li>
<li>There is probably already enough JavaScript running on a typical website</li>
<li>Standard XML parsers don't preserve all whitespace essential for code formatting</li>
<li>XML formatters often don't attempt to vertically align attributes and their contents</li>
</ul>
<h2>Future Work</h2>
<p>I hope to add much more in the way of options for this code-rendering XSLT. The XSLT used here is a spin-off from PathEnq project which is an XPath IDE web-application, so much of the embedded metadata in the output remains unexploited right now - as the XSLT is open source my hope is that other projects may be able to exploit this.</p>
<h2>Please give it a go!</h2>
<p>If you're publishing code samples in HTML in XSLT 2.0, XSD 1.1 or XPath 2.0, please give XMLSpectrum a try and let me know if any issues/features etc. You are also encouraged to fork the project and roll your own solution.</p>
<p></p>
</body>
</html>